import{x as e,y as a}from"../element-plus/element-plus.f4dce189.js";import{G as l,ax as s,i as t,r as i,Z as n,c as o,U as u,O as r,u as c,z as v,o as p,P as m,F as d,a7 as h,M as g,V as y}from"../@vue/@vue.59fec093.js";import{g as f,v as j,b as _,L as b,e as R,d as x,M as E,N as w,O as k,f as O,Q as C,_ as S}from"../../assets/index-831d6614.js";import{T}from"../Tab/Tab.63db5902.js";/* empty css                                                                                                                     */import{A as U}from"../index/index.2d322a4f.js";import{L as I}from"../Loading/Loading.24f30fa2.js";import{t as z}from"../lodash-es/lodash-es.3125e237.js";import"../@vueuse/@vueuse.c2bb539f.js";import"../@element-plus/@element-plus.189e73a2.js";import"../@popperjs/@popperjs.b78c3215.js";import"../@ctrl/@ctrl.91de2ec7.js";import"../dayjs/dayjs.c1293ab3.js";import"../async-validator/async-validator.cf877c1f.js";import"../memoize-one/memoize-one.63ab667a.js";import"../escape-html/escape-html.1935ddb3.js";import"../normalize-wheel-es/normalize-wheel-es.3222b0a2.js";import"../@floating-ui/@floating-ui.333ef71e.js";import"../vue-router/vue-router.10a7fca4.js";import"../hotkeys-js/hotkeys-js.e364e5e1.js";import"../pinia/pinia.81428a33.js";import"../axios/axios.d4208f68.js";import"../nprogress/nprogress.9249ff62.js";const L={class:"music-hall-container"},F=["infinite-scroll-disabled"],G=["infinite-scroll-disabled"],N=["infinite-scroll-disabled"],A=S(l({__name:"MusicHall",setup(l){s((e=>({"8d88b726":c(S),"69144c19":c(M),"42db36e4":c(A),"1e371c4e":K.value,"2a56f33e":c(H),"2d60b19e":P.value})));const S=f().get("fontColor"),A=f().get("shadow"),M=v("fontGray"),B=j(),H=t((()=>B.isFullScreen?"76.3vh":"73.3vh")),K=i("0px"),P=i("none"),Q=()=>{P.value="none",K.value="0"};let V=0;const Z=z((()=>{"block"!=P.value&&(P.value="block",K.value="6px"),V&&clearTimeout(V),V=setTimeout((()=>{"none"!=P.value&&Q()}),3e3)}),600,{leading:!0,trailing:!1}),q=v("firstLoading"),D=i(!1),J=n([]),W=n([]),X=n([]),Y=i(18),$=i(0),ee=i(!1),ae=async()=>{try{const e=await k(100,X[$.value]),{playlists:a}=e;a.forEach((e=>{const{name:a,id:l,coverImgUrl:s,playCount:t}=e;J[$.value].push({name:a,id:l,image:s,playCount:t,creator:{nickname:"",avatarUrl:""},description:"",tag:[]})}))}catch(e){R(x.ERROR,e.message)}0==$.value&&(W[$.value].push(...J[$.value].slice(0,Y.value)),q.value=!1),D.value&&(D.value=!1)},le=()=>{ee.value=!0,Y.value+=12,Y.value<J[$.value].length?setTimeout((()=>{W[$.value].push(...J[$.value].slice(Y.value-12,Y.value)),ee.value=!1}),100):(D.value=!0,$.value<X.length?(Y.value=0,W[$.value].push(...J[$.value].slice(W[$.value].length)),$.value++,ae(),ee.value=!1):(D.value=!1,R(x.INFO,"已经到底部啦！")))},se=n([]),te=n([]),ie=n([]),ne=i(18),oe=i(0),ue=i(!1),re=async()=>{try{const e=await O(100,ie[oe.value]),{playlists:a}=e;a.forEach((e=>{const{name:a,id:l,coverImgUrl:s,playCount:t}=e;se[oe.value].push({name:a,id:l,image:s,playCount:t,creator:{nickname:"",avatarUrl:""},description:"",tag:[]})}))}catch(e){R(x.ERROR,e.message)}0==oe.value&&(te[oe.value].push(...se[oe.value].slice(0,ne.value)),q.value=!1),D.value&&(D.value=!1)},ce=()=>{ue.value=!0,ne.value+=12,ne.value<se[$.value].length?setTimeout((()=>{te[oe.value].push(...se[oe.value].slice(ne.value-12,ne.value)),ue.value=!1}),100):(D.value=!0,oe.value<ie.length?(ne.value=0,te[oe.value].push(...se[oe.value].slice(te[oe.value].length)),oe.value++,re(),ue.value=!1):(D.value=!1,R(x.INFO,"已经到底部啦！")))},ve=n([]),pe=n([]),me=i(0),de=i(!1),he=()=>{de.value=!0,D.value=!0,me.value++,me.value<pe.length?(ge(),de.value=!1):(R(x.SUCCESS,"已经到达底部啦！"),D.value=!1)},ge=async()=>{try{const e=await C(pe[me.value].id),{data:{playlist:a}}=e;a.forEach((e=>{const{id:a,name:l,cover:s,playCount:t}=e;ve[me.value].push({id:a,name:l,image:s,playCount:t,description:"",tag:[],creator:{nickname:"",avatarUrl:""}})}))}catch(e){R(x.ERROR,e.message)}0==me.value&&(q.value=!1),D.value&&(D.value=!1)},ye=e=>{Q(),"rec"==e&&0==se[0].length?(q.value=!0,re()):"style"==e&&0==ve[0].length&&(q.value=!0,ge())};return _((async()=>{try{const e=await b(),{tags:a}=e;X.push(...a.map((e=>e.name))),X.forEach((()=>{J.push([]),W.push([])}))}catch(e){R(x.ERROR,e.message)}try{const e=await E(),{sub:a}=e;ie.push(...a.map((e=>e.name))),ie.forEach((()=>{se.push([]),te.push([])}))}catch(e){R(x.ERROR,e.message)}try{const e=await w(),{data:a}=e;a.forEach((e=>{const{tagId:a,tagName:l}=e;pe.push({id:a,name:l}),ve.push([])}))}catch(e){R(x.ERROR,e.message)}ae()}),q),(l,s)=>{const t=e,i=a;return p(),o("div",L,[u(T,{active:"top",onGetActive:ye},{content:r((()=>[u(t,{label:"精选歌单",name:"top"},{default:r((()=>[m((p(),o("div",{class:"container scroll-container",onScroll:s[0]||(s[0]=e=>c(Z)()),"infinite-scroll-distance":"2","infinite-scroll-immediate":!1,"infinite-scroll-disabled":ee.value,style:{overflow:"auto"}},[(p(!0),o(d,null,h(W,((e,a)=>m((p(),g(c(U),{key:X[a],title:X[a],playlists:e},null,8,["title","playlists"])),[[y,e.length>0]]))),128)),u(I,{"is-loading":D.value},null,8,["is-loading"])],40,F)),[[i,le]])])),_:1}),u(t,{label:"网友推荐",name:"rec"},{default:r((()=>[m((p(),o("div",{class:"container scroll-container",onScroll:s[1]||(s[1]=e=>c(Z)()),"infinite-scroll-distance":"2","infinite-scroll-immediate":!1,"infinite-scroll-disabled":ue.value,style:{overflow:"auto"}},[(p(!0),o(d,null,h(te,((e,a)=>m((p(),g(c(U),{key:ie[a],title:ie[a],playlists:e},null,8,["title","playlists"])),[[y,e.length>0]]))),128)),u(I,{"is-loading":D.value},null,8,["is-loading"])],40,G)),[[i,ce]])])),_:1}),u(t,{label:"浪漫曲风",name:"style"},{default:r((()=>[m((p(),o("div",{class:"container scroll-container",onScroll:s[2]||(s[2]=e=>c(Z)()),"infinite-scroll-distance":"2","infinite-scroll-immediate":!1,"infinite-scroll-disabled":de.value,style:{overflow:"auto"}},[(p(!0),o(d,null,h(ve,((e,a)=>m((p(),g(c(U),{key:pe[a].id,title:pe[a].name,playlists:e},null,8,["title","playlists"])),[[y,e.length>0]]))),128)),u(I,{"is-loading":D.value},null,8,["is-loading"])],40,N)),[[i,he]])])),_:1})])),_:1})])}}}),[["__scopeId","data-v-6dcf7238"]]);export{A as default};
